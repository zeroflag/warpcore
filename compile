#!/bin/bash

COMPILER=compiler.img
OUTPUT=output.img
LIB="lib.forth"
INPUT="/dev/stdin"

if [ -n "$1" ]; then
  INPUT="$1"
fi

rm -f "$OUTPUT"
rm -f "$COMPILER"

echo "Bootstrapping compiler.."
./bootstrap

echo "Compiling $1.."
cat "$LIB"   \
    "$INPUT" \
    | ./warp "$COMPILER"

echo "Running compiled output: $OUTPUT"

./warp "$OUTPUT"
